/***
 *  BetterFramework is BetterStudio framework for themes and plugins.
 *
 *  ______      _   _             ______                                           _
 *  | ___ \    | | | |            |  ___|                                         | |
 *  | |_/ / ___| |_| |_ ___ _ __  | |_ _ __ __ _ _ __ ___   _____      _____  _ __| | __
 *  | ___ \/ _ \ __| __/ _ \ '__| |  _| '__/ _` | '_ ` _ \ / _ \ \ /\ / / _ \| '__| |/ /
 *  | |_/ /  __/ |_| ||  __/ |    | | | | | (_| | | | | | |  __/\ V  V / (_) | |  |   <
 *  \____/ \___|\__|\__\___|_|    \_| |_|  \__,_|_| |_| |_|\___| \_/\_/ \___/|_|  |_|\_\
 *
 *  Copyright Â© 2017 Better Studio
 *
 *
 *  Our portfolio is here: http://themeforest.net/user/Better-Studio/portfolio
 *
 *  \--> BetterStudio, 2017 <--/
 */
!function(t){"use strict";var e=function(e,s){if(this.options=t.extend(!0,{itemBeforeHtml:'<li class="bssm-item {{class}}"{{#type}} data-item-type="{{type}}"{{/type}}{{#cat}} data-item-cat="{{cat}}"{{/cat}} data-item-id="{{id}}">',itemInnerHtml:"",itemAfterHtml:"</li>",modalHtml:!1,id:"modal-"+Math.ceil(1e3*Math.random()),bsModal:s||{},content:{},items:{},itemsGroupSize:6,fuse:{keys:["name"],tokenize:!0,matchAllTokens:!0,threshold:.3},searchDelay:300,overlayClickCloseModal:!0,searchAutoFocus:!0,selectedItemId:0,modalClass:"",categories:{},types:{},inactivateTypes:[],inactivateCats:[],noSidebar:!1,events:{show_item:function(t){t.style.display="inline-block"},hide_item:function(t){t.style.display="none"}}},e),!this.options.modalHtml){var i="";this._length(this.options.categories)&&(i='<div class="bssm-categories">\n    <h4 class="title"><span>{{filter_cat_title}}</span></h4>\n\n    <ul class="bssm-filter-items bf-radio-group">\n\n        {{#count_all}}\n        <li>\n            <div class="bf-radio-field" data-current-state="active" data-name="all"><span style="display: inline-block;"><i class="fa fa-circle" aria-hidden="true"></i></span></div>\n            <span class="name bf-radio-toggle" data-id="{{key}}">{{all_l10n}}</span><span class="length">({{count_all}})</span>\n        </li>\n        {{/count_all}}\n        \n        {{#filter_cats}}\n        <li>\n            <div class="bf-radio-field" data-current-state="deactivate" data-name="{{key}}"><span><i class="fa fa-circle" aria-hidden="true"></i></span></div>\n            <span class="name bf-radio-toggle" data-id="{{key}}">{{value}}</span><span class="length">({{count}})</span>\n        </li>\n        {{/filter_cats}}\n\n    </ul>\n</div>\n');var a="";this._length(this.options.types)&&(a='\n<div class="bssm-types">\n    <h4 class="title"><span>{{filter_type_title}}</span></h4>\n\n    <ul class="bssm-filter-items bf-radio-group">\n\n        {{#count_all}}\n        <li>\n            <div class="bf-radio-field" data-current-state="active" data-name="all"><span style="display: inline-block;"><i class="fa fa-circle" aria-hidden="true"></i></span></div>\n            <span class="name bf-radio-toggle" data-id="{{key}}">{{all_l10n}}</span><span class="length">({{count_all}})</span>\n        </li>\n        {{/count_all}}\n\n        {{#filter_types}}\n        <li>\n            <div class="bf-radio-field" data-current-state="deactivate" data-name="{{key}}"><span><i class="fa fa-circle" aria-hidden="true"></i></span></div>\n            <span class="name bf-radio-toggle" data-id="{{key}}">{{value}}</span>{{#count}}<span class="length">({{count}})</span>{{/count}}\n        </li>\n        {{/filter_types}}\n    </ul>\n</div>	'),this.options.modalHtml='<div class="bs-modal-default bs-selector-modal '+this.options.modalClass+'" {{#inline_style}} style="{{inline_style}}" {{/inline_style}}>\n{{#close_button}}\n<a href="#" class="bs-close-modal">\n    <i class="fa fa-times" aria-hidden="true"></i>\n</a>\n{{/close_button}}\n<div class="bs-modal-header-wrapper bs-modal-clearfix">\n    <h2 class="bs-modal-header">\n        {{#icon}}\n        <i class="fa {{icon}}"></i>\n        {{/icon}}\n\n        {{{header}}}\n    </h2>\n</div>\n\n<div class="bs-modal-body">\n    <!--{{{bs_body}}}-->\n\n    <input type="hidden" name="item" class="bssm-input">\n\n    <div class="bssm-content {{content_class}}">\n        <ul class="bssm-list">\n            {{#items}}\n                '+this.options.itemBeforeHtml+this.options.itemInnerHtml+this.options.itemAfterHtml+'        \n            {{/items}}\n        </ul>\n    </div>\n    <div class="bssm-sidebar">\n        <div class="bssm-search">\n            <input type="text" class="bssm-search-input" value="" placeholder="{{search}}" autofocus>\n            <i class="fa fa-search"></i>\n        </div>\n\n        <div class="bssm-filter">\n            \n            '+i+a+"              </div>\n\n     \n    </div>\n</div>"}this.bsModal=!1,this.$allItems=!1,this.$itemsCache={},this._scrollIntoView=[],this._visibleItems=[],this.selectedItem=!1,this.initialized=!1,this.fuse=new Fuse(this.options.items,this.options.fuse),this.init()};e.prototype={init:function(){var e=this;e.initialized=!0,t.bs_modal_template(this.options.id,this.options.modalHtml);var s={modalId:this.options.id,buttons:this.options.buttons,destroyHtml:!1,modalClass:this.options.modalClass,show:!1,styles:{container:"width: 1060px;max-width:100%"},template:this.options.id,content:e._getModalContent(),events:{before_append_html:function(){},after_append_html:function(){e.bsModal=this,e.options.noSidebar&&e.bsModal.$modal.addClass("no-sidebar"),e.updateItemsList(),e._bindEvents(),e._clearSearchResults(),e._updateSidebarCheckboxStatus(),e.handleEvent("after_append_html","")},modal_closed:function(){e._clearSearchResults(),e._updateSidebarCheckboxStatus("dont-refresh-items"),e._showHide(e.$allItems,!0),e.handleEvent("modal_closed",""),e.initialized=!1},modal_loaded:function(){e.options.searchAutoFocus&&t("input.bssm-search-input",this.$modal).focus(),e.handleEvent("modal_loaded","")},modal_show:function(){e.handleEvent("modal_show",""),e.initialized&&e.scrollIntoView(0,e.options.itemsGroupSize)}}};t.bs_modal(t.extend(!0,s,e.options.bsModal))},show:function(){this.bsModal.show()},updateItemsList:function(){this.$allItems=t(".bssm-item",this.bsModal.$modal)},_bindEvents:function(){function e(t){n._visibleItems=t}function s(){function e(e){var s=[],i=t(".bssm-"+e+" .bf-radio-field[data-current-state='active']",o).data("name");if(i)if("all"===i){var a="categories"===e?"filter_cats":"filter_"+e;n.bsModal.options.content[a]&&n.bsModal.options.content[a].forEach(function(t){s.push(t.key)})}else s.push(i);return s}var s={};return n._length(n.options.types)&&(s.itemType=e("types")),n._length(n.options.categories)&&(s.itemCat=e("categories")),n._filterItems(function(){return function(e){var i,a,o=n.$(e).data();for(var l in s)if(i=s[l],""!==o[l]){a=n.json_decode(o[l]),"string"==typeof a&&(a=[a]),"string"==typeof i&&(i=[i]);for(var r=!1,c=0;c<a.length;c++)if(t.inArray(a[c],i)>-1){r=!0;break}if(!r)return!1}return!0}(this)})}function i(){function t(){var t=l.width(),e=l.find(".bssm-item").outerWidth(!0);return Math.max(1,Math.floor(t/e))}function e(){var e=n.options.itemsGroupSize/t();return Math.ceil(l.scrollTop()/(s*e))}var s=r.outerHeight(!0),i=e();if(i){var a=i*n.options.itemsGroupSize;n.scrollIntoView(a,a+n.options.itemsGroupSize)}}function a(s,i){if(-1===t.inArray(s.which,[32,27])){clearTimeout(c);var a=t.trim(this.value),l=t(this).parent(),r=l.find("i.fa");l[a?"addClass":"removeClass"]("active"),a?r.addClass("fa-times-circle").removeClass("fa-search"):r.removeClass("fa-times-circle").addClass("fa-search"),"change-icon"!==i&&(c=setTimeout(function(){if(t(".bssm-filter-items .bf-radio-field[data-name='all']",o).trigger("click",["search"]),a){var s=[];n.fuse.search(a).forEach(function(t){s.push(t.id)});for(var i,l=[],r=0;r<n.$allItems.length;r++)i=-1!==s.indexOf(n.get_attr(n.$allItems[r],"itemId")),i&&l.push(n.$allItems[r]);n._showHide(n.$allItems,!1),n._showHide(l,!0),e(l)}else n.$allItems.show(),e(n.$allItems)},n.options.searchDelay))}}var n=this,o=this.bsModal.$modal;e(n.$allItems);var l=t(".bssm-list",o),r=l.find(".bssm-item");n._cacheItems(r),n.eventExists("item_click")&&l.on("click",".bssm-item",function(){n.handleEvent("item_click",this)}),l.on("click",".bssm-item",function(){var t=n.$(this);n.markAsSelected(t),n.handleEvent("item_select",this,t.data("item-id"))});var c;t(".bssm-search",o).each(function(){var e=t(this);t(".bssm-search-input",e).on("keyup",a),e.on("click",".fa-times-circle",function(){var s=t(".bssm-search-input",e);s.val(""),s.trigger("keyup")})}),t(".bssm-sidebar .bf-radio-group",o).on("bf-radio-change",function(i,a,l){if("dont-refresh-items"!==l){"search"!==l&&t(".bssm-search-input",o).val("").trigger("keyup",["change-icon"]);var r=s();n._showHide(n.$allItems,!1),n._showHide(r,!0),e(r)}}),n.eventExists("scrollIntoView")&&l.on("scroll",function(){i()}),n.options.overlayClickCloseModal&&n.bsModal.find(".bs-modal-overlay").on("click",function(){n.bsModal.close_modal()})},scrollIntoView:function(t,e){for(var s,i=this,a=i._visibleItems.slice(t,e),n=[],o=0;o<a.length;o++)s=i.get_attr(a[o],"itemId"),-1===i._scrollIntoView.indexOf(s)&&(i._scrollIntoView.push(s),n.push(a[o]));n.length&&i.handleEvent("scrollIntoView",n,t,e)},getSelectedItem:function(){return this.selectedItem},setSelectedItem:function(t,e){this.selectedItem=[t,e]},markAsSelected:function(t){this.$allItems.removeClass("bssm-selected"),t.addClass("bssm-selected"),this.setSelectedItem(t,t.data("item-id"))},json_encode:function(t){return t=JSON.stringify(t),t.replace(/"/g,'\\"').replace(/'/g,"\\'")},json_decode:function(t){return t=t.replace(/\\"/g,'"').replace(/\\'/g,"'"),JSON.parse(t)},_getModalContent:function(){function e(t,e){for(var s,i=0;i<t.length;i++)s=t[i].key,"undefined"!=typeof e[s]?t[i].count=String(e[s]):t[i].count="0";return t}function s(t){for(var e,s={},i=0;l>i;i++)"object"==typeof a.options.items[i]&&(e=a.options.items[i][t],s[e]?s[e]++:s[e]=1);return s}var i,a=this,n=a.options.content,o=a.options;n.items=[],a.options.items.forEach(function(e){var s=t.extend({},e);s.cat&&(s.cat=a.json_encode(e.cat)),s.type&&(s.type=a.json_encode(e.type)),n.items.push(s)});for(var l=a._length(a.options.items),r=0,c=0;l>c;c++)"object"==typeof a.options.items[c]&&"default"!==a.options.items[c].id&&r++;return i=a._prepareObjectForMustache(o.categories),n.filter_cats=e(i,s("cat")),i=a._prepareObjectForMustache(o.types),n.filter_types=e(i,s("type")),n.count_all=r,this.handleEvent("modal_content",n)},_updateSidebarCheckboxStatus:function(e){var s=this;t(".bssm-sidebar .name[data-id]",s.bsModal.$modal).each(function(){var i=t(this),a=i.parent().find(".bf-checkbox-multi-state"),n=a.data("current-state");t.inArray(i.data("id"),s.options.inactivateTypes)>-1?"none"!==n&&a.trigger("click",[e]):"active"!==n&&a.trigger("click",[e])})},_clearSearchResults:function(){return},_filterItems:function(t){return this.$allItems.filter(t)},handleEvent:function(t,e){var s=Array.prototype.slice.call(arguments,1);return"function"==typeof this.options.events[t]?this.options.events[t].apply(this,s):e},eventExists:function(t){return"function"==typeof this.options.events[t]},$:function(e){if(e.dataset.itemId){var s=e.dataset.itemId;return s in this.$itemsCache||(this.$itemsCache[e.dataset.itemId]=t(e,this.$modal)),this.$itemsCache[e.dataset.itemId]}return t(e,this.$modal)},selectItem:function(e){return e in this.$itemsCache||(this.$itemsCache[e]=t('.bssm-item[data-item-id="'+e+'"]',this.bsModal.$modal)),this.$itemsCache[e]},_showHide:function(t,e){for(var s=e?"show_item":"hide_item",i=0;i<t.length;i++)t[i]&&this.handleEvent(s,t[i])},get_attr:function(t,e){return t.dataset?t.dataset[e]:this.$(t,this.bsModal.$modal).attr(e)},_prepareObjectForMustache:function(t){var e=[];for(var s in t)e.push({key:s,value:t[s]});return e},_cacheItems:function(e){this.$itemsCache={};for(var s,i,a=0;a<e.length;a++)s=t(e[a]),i=s.data("item-id"),this.$itemsCache[i]=s},_length:function(t){if(!t)return 0;if(Object.keys)return Object.keys(t).length;var e,s=0;for(e in t)t.hasOwnProperty(e)&&s++;return s}},t.bs_selector_modal=function(t,s){return new e(t,s)}}(jQuery);